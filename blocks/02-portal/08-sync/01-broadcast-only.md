---
id: sync-broadcast-only
category: sync
label: BroadcastChannel만
summary: 같은 브라우저 내의 탭/창 간 동기화만 지원하며, 다른 기기와의 동기화는 새로고침에 의존한다.
pros:
  - 추가 서버 인프라 없이 브라우저 내장 API만으로 구현 가능
  - 구현이 단순하며 네트워크 지연 없이 즉시 동기화
  - 인증 상태, 테마 변경, 알림 전파 등 핵심 시나리오 해결
  - 서버 부하 없음 (클라이언트 간 직접 통신)
cons:
  - 같은 브라우저 내에서만 동작하여, 다른 기기/브라우저에서는 동기화 안 됨
  - 실시간 데이터(설비 모니터링 등)는 각 탭이 독립적으로 서버에 요청해야 함
  - 한 기기에서 데이터를 수정해도 다른 기기에서 새로고침 전까지 반영 안 됨
  - IE/구형 브라우저에서 BroadcastChannel API 미지원 (폴백 필요)
bestFor:
  - 사용자가 단일 기기/브라우저에서만 포털을 사용하는 환경
  - 다른 기기 간 실시간 동기화가 필요하지 않은 시스템
  - WebSocket 인프라를 구축하기 어려운 초기 단계
---

## 개요

BroadcastChannel API는 같은 출처(origin)의 브라우저 탭/창/iframe 간에 메시지를 교환할 수 있는 웹 표준 API이다. 추가 서버 없이 브라우저가 자체적으로 메시지를 중계하므로, 네트워크 지연이 없고 구현이 단순하다.

이 전략은 "같은 PC, 같은 브라우저" 범위의 동기화만 보장한다. 다른 기기나 다른 브라우저에서는 동기화가 되지 않으며, 페이지 새로고침 시 서버에서 최신 상태를 다시 가져오는 방식으로 대응한다.

## 동기화 대상별 동작

### 인증 상태 동기화

| 이벤트 | 동작 |
|--------|------|
| 토큰 갱신 | 갱신된 토큰을 모든 탭에 전파 → 각 탭이 메모리에 새 토큰 반영 |
| 로그아웃 | 로그아웃 메시지를 전파 → 모든 탭이 로그인 페이지로 리다이렉트 |
| 세션 만료 | 세션 만료 알림 전파 → 모든 탭에 재인증 안내 |

### 이벤트 전파

| 이벤트 | 소스 | 수신 대상 |
|--------|------|----------|
| 알림 수신 | 알림 수신 탭 | 모든 탭 (배지 갱신) |
| 테마 변경 | 설정 변경 탭 | 모든 탭 (CSS 변수 교체) |
| 데이터 변경 | 수정 발생 탭 | 같은 데이터를 표시 중인 탭 |
| 워크스페이스 저장 | 저장 발생 탭 | 불필요 (로컬 이벤트) |

### 메시지 프로토콜

BroadcastChannel에서 교환하는 메시지는 다음 구조를 따른다:

| 필드 | 설명 |
|------|------|
| type | 이벤트 유형 (AUTH_REFRESH, LOGOUT, DATA_CHANGE, NOTIFICATION 등) |
| payload | 이벤트 데이터 |
| sourceTabId | 발신 탭 식별자 (자기 자신의 메시지 무시용) |
| timestamp | 발생 시각 |

## BroadcastChannel 미지원 브라우저 폴백

BroadcastChannel을 지원하지 않는 환경에서의 대안:

| 폴백 방식 | 원리 | 호환성 |
|-----------|------|--------|
| **localStorage 이벤트** | localStorage 변경 시 다른 탭에서 storage 이벤트 수신 | 모든 브라우저 |
| **SharedWorker** | 공유 웹 워커를 통한 탭 간 통신 | 대부분의 브라우저 |

localStorage 이벤트가 가장 범용적인 폴백이며, BroadcastChannel과 동일한 인터페이스로 래핑하여 사용할 수 있다.

## 한계: 크로스 기기 시나리오

BroadcastChannel만으로는 해결되지 않는 시나리오:

| 시나리오 | 문제 | 우회 방법 |
|---------|------|----------|
| PC A에서 데이터 수정 → PC B에서 확인 | PC B는 수정 사실을 모름 | 새로고침 또는 목록 재조회 시 서버에서 최신 데이터 로딩 |
| PC A에서 로그아웃 → PC B 세션 유지 | PC B는 여전히 로그인 상태 | 서버 측 세션 만료로 자연 로그아웃 (즉시는 아님) |
| 설비 이상 알림 → 모든 기기에 전달 | BroadcastChannel은 같은 브라우저만 | 각 기기가 독립적으로 알림 API를 폴링하거나 SSE 수신 |

## 제약 사항 및 고려사항

1. **단일 브라우저 한정**: 같은 출처, 같은 브라우저 내에서만 동작
2. **직렬화**: 메시지는 Structured Clone Algorithm으로 직렬화되므로, 함수나 DOM 참조는 전달 불가
3. **순서 보장 없음**: 메시지 도착 순서가 보장되지 않으므로, 순서 의존 로직에는 타임스탬프 기반 정렬 필요
4. **메시지 크기**: 대량 데이터를 BroadcastChannel로 전달하면 성능 저하 가능 → 변경 알림만 전달하고 데이터는 각 탭이 직접 로딩
